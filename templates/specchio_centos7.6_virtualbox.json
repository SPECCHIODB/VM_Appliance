{
    "variables": {
	    "bridge_adapter": "eno1",
	    "vbox_version": "6.0.0"
    },
    "builders": [
	{
		"type": "virtualbox-iso",
		"format": "ova",
	    "boot_command": [
		    "<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg<enter><wait>"
	    ],
	    "shutdown_command": "echo 'specchio'|sudo -S /sbin/halt -h -p",
	    "boot_wait": "10s",
	    "http_directory": "http",
	    "iso_urls": ["https://pkg.adfinis-sygroup.ch/centos/7.6.1810/isos/x86_64/CentOS-7-x86_64-Minimal-1810.iso"],
	    "iso_checksum_type": "sha256",
	    "iso_checksum": "38d5d51d9d100fd73df031ffd6bd8b1297ce24660dc8c13a3b8b4534a4bd291c",
	    "headless": true,
	    "guest_os_type": "RedHat_64",
	    "disk_size": 102400,
	    "guest_additions_path": "VBoxGuestAdditions_{{user `vbox_version`}}.iso",
	    "guest_additions_url": "https://download.virtualbox.org/virtualbox/{{user `vbox_version`}}/VBoxGuestAdditions_{{user `vbox_version`}}.iso",
	    "guest_additions_sha256": "169efc28d82cbf2d0b0156454cc290e2fae49534b6d4adf3bac06e0fefba8fa5",
	    "virtualbox_version_file": ".vbox_version",
	    "vm_name": "specchio-centos-7.6-vbox-x86_64",
	    "vboxmanage": [
		[
		    "modifyvm",
		    "{{.Name}}",
		    "--memory",
		    "2048"
		],
		[
		    "modifyvm",
		    "{{.Name}}",
		    "--cpus",
		    "1"
		],
		[
		    "modifyvm",
		    "{{.Name}}",
		    "--natpf1",
		    "specchio_http,tcp,,8080,,8080"
		],
		[
		    "modifyvm",
		    "{{.Name}}",
		    "--natpf1",
		    "specchio_https,tcp,,8181,,8181"
		],
		[
		    "modifyvm", "{{.Name}}",
		    "--vram", "128"
		],
		[
		    "modifyvm", "{{.Name}}",
		    "--clipboard", "bidirectional"
		]
	    ],
	    "ssh_username": "specchio",
	    "ssh_password": "specchio",
	    "ssh_wait_timeout": "60m"
	}
    ],
    "provisioners": [
  	{
  	    "type": "shell",
  	    "inline": [
		    "sudo yum install -y epel-release",
		    "sudo yum install -y ansible"
	    ]
	},
	{
	    "type": "ansible-local",
	    "playbook_file": "ansible/playbook.yml",
	    "role_paths": [
            "ansible/roles/specchio_backup_tool",
            "ansible/roles/specchio_client",
            "ansible/roles/specchio_webapp"
        ]
  	},
  	{
  	    "type": "shell",
  	    "inline": [
		"sudo yum install -y bzip2 gcc perl make kernel-devel",
		"sudo mount -t iso9660 -o loop /home/specchio/VBoxGuestAdditions_6.0.0.iso /media",
		"sudo /media/VBoxLinuxAdditions.run",
		"sudo umount /media"
	    ]
	}
    ],
    "post-processors": [
	{
	    "type": "vagrant",
	    "keep_input_artifact": true
	},
	{
	    "type": "checksum"
	}
    ]
}
